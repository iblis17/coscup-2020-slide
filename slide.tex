\documentclass[aspectratio=169]{beamer}

\usetheme{Berlin}

\usepackage{textcomp}

% Chinese typesetting
\usepackage{xeCJK}
\setCJKmainfont{HanWangWCL06}
\setmainfont{Fira Code}

\title{The Ports Framework Workshop}
\author{Iblis Lin \textlangle{}iblis@hs.ntnu.edu.tw\textrangle{}}

\setbeamertemplate{footline}[frame number]

\begin{document}


\begin{frame}
  \titlepage
\end{frame}

\begin{frame}[t,fragile]{Topics}
  \begin{itemize}
    \item Making a New Port
      \begin{itemize}
        \item Dir Structure
        \item ports-mgmt/porttools
        \item Description File
        \item Checksum File
        \item Package List
      \end{itemize}
    \item Upgrading a port
  \end{itemize}
\end{frame}

\begin{frame}[t,fragile]{Resources}
  \begin{itemize}
    \item \href{https://www.freebsd.org/doc/en_US.ISO8859-1/books/porters-handbook/book.html}{Porter's Handbook}
    \item \verb|/usr/ports/|
      \begin{itemize}
        \item \verb|Mk/bsd.port.mk|
      \end{itemize}
  \end{itemize}
\end{frame}

\section{Making a New Port}
\begin{frame}[t,fragile]{Dir Structure}
  \begin{itemize}
    \item Ports framework 本身是由一大堆的 \verb|Makefile| 堆砌而成
    \item 東西長在 \verb|/usr/ports/Mk/*|
    \item 一個簡單的範例 \verb|ports-mgmt/porttools|
  \end{itemize}

  \begin{verbatim}
  └─[iblis@GaeBuidhe]% find ports-mgmt/porttools
  ports-mgmt/porttools
  ports-mgmt/porttools/pkg-plist
  ports-mgmt/porttools/pkg-descr
  ports-mgmt/porttools/distinfo
  ports-mgmt/porttools/Makefile
  \end{verbatim}
\end{frame}

\begin{frame}[t,fragile]{Getting Started with ports-mgmt/porttools}
  \begin{itemize}
    \item \verb`mkdir ports`
    \item \verb`git clone https://github.com/freebsd/freebsd-ports.git ports/dev`
    \item \verb`cd ports/dev/devel`
    \item \verb`port create foo`
  \end{itemize}
\end{frame}

\begin{frame}[t,fragile]{Getting Started with ports-mgmt/porttools}
  \begin{itemize}
    \item \verb|make -V| 方便 debug
    \item E.g \verb|make -V PORTNAME|
  \end{itemize}
\end{frame}

\begin{frame}[t]{Makefile}
  \begin{itemize}
    \item Port framework 定義了 build 一個 port 所需要的 make target
    \item 每個 target 都還會有，pre-<target> 跟 post-<target> hooks 可以使用
  \end{itemize}
  \begin{enumerate}
    \item fetch
    \item extract
    \item patch
    \item configure
    \item build
    \item stage
    \item package
    \item install
  \end{enumerate}
\end{frame}

\begin{frame}[t,fragile]{Description File: pkg-descr}
  \begin{itemize}
    \item pkg-descr 放些關於這個 port 的介紹
  \end{itemize}
\end{frame}

\begin{frame}[t,fragile]{Checksum File}
  \begin{itemize}
    \item 設定好 \verb`MASTER_SITES`
    \item 如果用 GitHub 有 shorthand, e.g. \verb`math/openlibm`
  \end{itemize}
  \begin{block}{Autogenerated Checksum}
    \verb`make makesum`
  \end{block}
  \begin{itemize}
    \item 最後得到 \verb`distinfo`
  \end{itemize}
\end{frame}

\begin{frame}[t,fragile]{Package List: pkg-plist}
  \verb`pkg-plist` 即為 package list，裡面表列這個 port 會裝到 \verb`PREFIX` 的哪裡
  \begin{itemize}
      \item 這裡面都是相對路徑
      \item 可以手寫，也可以自動產出一份清單再來改
      \item \verb`make makeplist`
  \end{itemize}

  \begin{block}{PREFIX}
    \verb`└─[iblis@GaeBuidhe]% make -V PREFIX`

    \verb`/usr/local`
  \end{block}

\end{frame}

\begin{frame}[t,fragile]{Testing the Port via Poudriere}
  \begin{itemize}
    \item \verb`ports-mgmt/poudriere`
    \item Idea
      \begin{itemize}
        \item 在乾淨的環境 build port，透過 Jails
        \item 在不同的 world build，透過 Jails
        \item 用不同的 ports tree build
      \end{itemize}
  \end{itemize}
\end{frame}

\section{Updating a Port}
\begin{frame}[t]{TBD}
  t
\end{frame}

\end{document}
